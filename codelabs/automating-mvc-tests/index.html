
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Automated Tests of Spring MVC</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="automating-mvc-tests"
                  title="Automated Tests of Spring MVC"
                  environment="web"
                  feedback-link="">
    
      <google-codelab-step label="Overview" duration="10">
        <h2 class="checklist" is-upgraded>What You&#39;ll Learn</h2>
<ul class="checklist">
<li>How to write automated tests that invoke web requests and check responses</li>
<li>How Spring supports testing</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Understand the goal" duration="0">
        <p>We want to send a series of requests to the application and check the responses.<br>We want to check both the HTTP status code and the response body.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Add test code" duration="0">
        <p>Remember the folders that were generated by Spring?</p>
<p>It generated a parallel set of test folders.  We will add a package and a class to<br>/src/test/java.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Create a package" duration="0">
        <p>In the sample code, we&#39;ve created a sub-package called &#34;mvc&#34; to distinguish the types of test.<br>There are many views on whether the test packages should match the application packages.<br><br>The consensus is that they shouldn&#39;t and the tests should actually focus on what needs to be<br>tested rather than mirroring how the code is structured.  This makes sense as we will want<br>to change the structure of the application main code, but leave the tests untouched.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Create the test class" duration="0">
        <p>There are a number of steps to making a test.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Add an annotated class" duration="0">
        <pre><code>@AutoConfigureMockMvc
@ContextConfiguration(classes = {ExampleController.class})
@WebMvcTest
public class GreetingsTests {
</code></pre>
<p>What do these annotations do?</p>
<ul>
<li>AutoConfigureMockMvc - tells Spring to create a mock MVC container.  This avoids having to start a full server which means the tests run faster.  It also means that certain parts of the container are not loaded thus limiting the tests that can be run.</li>
<li>ContextConfiguration - tells Spring which beans (components) to load as part of the container. Typically, which components are being tested.  Here we are testing the ExampleController.</li>
<li>WebMvcTest - tells Spring to configure MVC-related components only.  We&#39;ll understand this more later when we add other types of components.  By limiting the types of components that get loaded, we will get faster setup time so the total time for testing will go down.  We don&#39;t want to find excuses not to write and run tests so Spring helps by offering options to speed up their execution.</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Inject the mock container" duration="0">
        <p>In order to run the tests, we need the controller beans to be loaded into a suitable container (so that Spring can route the requests to the controller).</p>
<pre><code>@Autowired
private MockMvc mockMvc;
</code></pre>
<p>The @Autowired annotation asks Spring to provide the test with a MockMvc component.  This is an example of dependency injection.<br>In order to run tests, the test code is dependent on the a MockMvc component.  The test class doesn&#39;t create an instance of the class, rather it asks<br>Spring to inject one.  This is a core part of Spring (indeed of most frameworks).  Search for the SOLID design principles online.  You will find that the D in SOLID is for Dependency Injection.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Write the tests" duration="0">
        <pre><code>@Test
 public void shouldGetInformalGreeting() throws Exception {

   this.mockMvc
           .perform(get(&#34;/greet/informal&#34;))
           .andDo(print())
           .andExpect(status().isOk())
           .andExpect(content().string(containsString(&#34;CM6713&#34;)))
           .andExpect(content().string(containsString(&#34;Hi...&#34;)));
 }
</code></pre>
<p>The method is annotated with a standard @Test annotation.  This tells the test<br>framework that this is a test.</p>
<h2 is-upgraded>Perform the request.</h2>
<pre><code>   this.mockMvc
           .perform(get(&#34;/greet/informal&#34;))
</code></pre>
<p>This makes the web request to the mock MVC container.  We would expect this to be routed to<br>our controller.</p>
<h2 is-upgraded>Output to the console</h2>
<pre><code>.andDo(print())
</code></pre>
<p>This tells Spring to output the results of the test.</p>
<h2 is-upgraded>Check the HTTP status</h2>
<pre><code>.andExpect(status().isOk())
</code></pre>
<p>We expect this request to work, so we expect a 200 (OK) response.<br>At this point, you need to remind yourselves of the REST principles that<br>you touched on in earlier modules.  REST uses the HTTP status code and HTTP verbs<br>as first class players in the design of RESTful APIs.</p>
<h2 is-upgraded>Check the content</h2>
<p>Here we expect to receive the defaults.</p>
<pre><code>.andExpect(content().string(containsString(&#34;CM6713&#34;)))
.andExpect(content().string(containsString(&#34;Hi...&#34;)));
</code></pre>
<p>Finally we need to check the content.  With this request, we expect the content to contain<br>the strings provided.  Typically, we would check more than this.<br>Where we&#39;re generating HTML, we would look certain HTML fragments.<br>If we were testing a RESTful API, we would look for JSON fragments.</p>
<p>Spring provides convenience methods for targetting certain fragments of both.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Other Tests" duration="0">
        <p>The sample code provides other tests as examples including a test for a missing resource and for redirections.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Run the code" duration="0">
        <p>To run the full, we need to run Tasks &gt; build &gt; build from the Intellij Gradle window.</p>
<p>We won&#39;t see the full test results in the run window.</p>
<p>To do that, run the Tasks &gt; verification &gt; check task.</p>
<p>You can click on each test to see the output (from <code>java andDo(print())</code>).</p>
<p class="image-container"><img alt="Test output in IntelliJ" src="img\512dea9b9468f454.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Review" duration="0">
        <p>In this tutorial, we&#39;ve introduced automated tests.  One of the leaps that Spring brought over<br>previous frameworks was its support for testing and in particular the ability to run tests quickly and<br>with reduced server start-up time.</p>
<p>Research Spring&#39;s <a href="https://spring.io/guides/gs/testing-web/" target="_blank">other testing facilities</a> and <a href="https://docs.spring.io/spring-boot/docs/2.3.4.RELEASE/reference/html/spring-boot-features.html#boot-features-testing" target="_blank">references</a>.</p>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>

</body>
</html>
